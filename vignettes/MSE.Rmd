---
title: "Management Strategy Evaluation"
author: "Malcolm Haddon"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Management Strategy Evaluation}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  echo = TRUE,
  message = FALSE,
  warning = FALSE
)

options(knitr.kable.NA = "",
        knitr.table.format = "pandoc")

options("show.signif.stars"=FALSE,
        "stringsAsFactors"=FALSE,
        "max.print"=50000,
        "width"=240)

library(aMSE)
library(knitr)
library(captioner)

tab_nums <- captioner(prefix = "Table")
fig_nums <- captioner(prefix = "Figure")

```


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { 
      equationNumbers: { 
            autoNumber: "all",
            formatNumber: function (n) {return '3.'+n}
      } 
  }
});
</script>



# Introduction

### Management Strategy Evaluation

Comparing the relative effectiveness of alternative harvest strategies for particular fisheries generally requires the use of Management Strategy Evaluation (Haddon, 2007; Punt _et al_. 2016). As stated by Punt _et al_. (2016, p303). 

"Management strategy evaluation (MSE) involves using simulation to compare the relative effectiveness for achieving management objectives of different combinations of data collection schemes, methods of analysis and subsequent processes leading to management actions. MSE can be used to identify a ‘best’ management strategy among a set of candidate strategies, or to determine how well an existing strategy performs. The ability of MSE to facilitate fisheries management achieving its aims depends on how well uncertainty is represented, and how effectively the results of simulations are summarized and presented to the decision-makers. Key challenges for effective use of MSE therefore include characterizing objectives and uncertainty, assigning plausibility ranks to the trials considered, and working with decision makers to interpret and implement the results of the MSE." 

The simulations referred to involve simulating the biological and fishery/fleet dynamics of the fishery being considered. This simulation model, usually termed the _Operating Model_ is either fitted to a real fishery or conditioned to reflect the observed properties of a real fishery. EXPAND Once conditioned, the operating model is taken to represent reality and is used to simulate the dynamics of a fishery as it would operate under the different harvest strategies (HS).  

The essential aspect of the simulation that makes an MSE differ from a standard forward projection of a stock assessment (a classical risk assessment; Francis, 1992) is the built in feedback of the regular management advice. The complete dynamics of the stock and fishery are simulated each year, the HS (data sampling, assessment/analysis, and harvest control rule) is applied however often the HS dictates, and the outcome of the simulated HS is fed back into the operating model, which could be expected to alter the path of the expected dynamics. In this way different HS can be expected to have different simulation outcomes over a set number of years.

### Simpler is Not Necessarily Better

MSE is often represented in an overly simplistic fashion leading to un-realistic expectations. It is important to remember that, as with any model, if an operating model does not include a particular feature in its dynamics (e.g. does not include depensation in its recruitment dynamics, or non-linearity in the relationship between stock biomass and CPUE) then those features can never be expressed in the simulations. The structure of an operating model needs to be well documented and its limitations understood so that the limitations of the MSE testing of each HS are known. This is especially important to understand because harvest strategies that have been MSE tested are generally held in relatively high regard. However, the MSE testing will always be constrained to the dynamics described by the operating model, so care in its design is required and that design needs to be defensible.

### Harvest Strategies

A harvest strategy (Smith, 1997), or HS, has a minimum of three components:

1. Specified and representative data collected from the fishery being evaluated

2. An Assessment or analysis of the fishery, based on the data collected, that estimates its status relative to pre-defined target and limit reference points

3. A formal harvest control rule (decision rule) that defines previously agreed management advice (future catch or effort levels, etc) in response to a stock's status relative to its reference points.

Each of the three components can be varied in multiple ways and each such combination would constitute a different harvest strategy (HS). For any fishery, therefore, there will be multiple potential options available for the management. Generally, fishery management involves balancing trade-offs between conflicting objectives. For example, with a valuable species such as abalone (e.g. blacklip abalone, _Haliotis rubra_) the two objectives of maintaining a sustainable stock and maximizing the profitable catch are potentially in conflict. Such potential conflicts are why management strategy evaluation was developed to enable the comparison of alternative harvest strategies. It is used to select an optimum HS, or at least reject sub-optimal ones.

### Management Strategy Evaluation of Abalone Fisheries

In this document we will be examining the simulation framework to be used to test alternative harvest strategies for different abalone stocks around Australia. This framework is contained in the R package __aMSE__. This package contains the necessary functions to put together a working simulation framework, then help condition that framework to simulate a particular fishery, and finally to apply the model to make a comparison between a selection of alternative harvest strategies. But, of course, this is a relatively complex model and to use it successfully requires understanding something of the conceptual structure used to define the operating model and associated processes. This vignette will attempt to begin that process, especially by using worked examples to get the user started.

There have been attempts to conduct management strategy evaluation (MSE) of alternative harvest strategies for abalone fisheries (Haddon _et al_., 2011; Haddon and Mundy, 2016; Haddon and Helidoniotis, 2013), and a recent R package __aMSE__ has been developed and has evolved following on from those attempts. 

The R code in the __aMSE__ package is the start of a translation and further development of the Abalone MSE code developed and used in Haddon and Mundy (2016),  which, in turn, was developed further from that produced in Haddon _et al_ (2013). The essential equations describing the operating model dynamics for the Haddon _et al_ (2013) report were formally published in Haddon and Helidoniotis (2013). Those dynamics have since been found to be overly complex in some parts and not complex enough in other parts. The overly complex part invovled using separate vectors of numbers-at-length to describe the cryptic and emergent components of each abalone population. Other unpublished work demonstrated that this separation has no real advantages but does have computational disadvantages. The new __aMSE__ package reflects this by translating the previous code into using a single vector of numbers-at-length to contain the dynamics. In addition, other methods are being incrementally implemented with the intent of speeding the computations, which previously could take many hours to appropriately explore even a single HS. The 'not complex enough' part, related to the larval dispersal, which received only a very light treatment in the earlier works. In aMSE, the option of including potentially significant levels of larval dispersal have been incorporated, which makes it simpler to include the examination of greenlip abalone (_Haliotis laevigata_) management as well as blacklip abalone.

The underlying objective in the current R package is to enable the simulations and MSE testing of different HS to proceed by users familiar with R, but without months of introductory training with the software and concepts involved. This vignette is a first attempt to provide the background required for others to successfully run the software. While writing this vignette sections will be borrowed freely from both Haddon _et al_ (2013) and Haddon and Mundy (2016) wherever it is appropriate. These two original projects in which earlier verrsions of the current abalone MSE code was first developed did not provide sufficient time or resources to generate a more user-friendly code-base for the software. The lack of such more user-friendly software greatly reduces the capacity to apply these methods to more stocks or new HS currently being developed. By making the new R package freely available the intent and hope is that more people will find the methods workable. By being made open source software this also allows for future developments of the package by others should they wish. One primary objective is to allow users to write their own functions describing any new harvest strategy they might develop. How difficult arranging such an open interface will be has yet to be discovered.  

### Difficulties Inherent with MSE Testing Abalone HS

The phrase 'abalone stock' sounds meaningful and most would consider this to refer to the standard notion of populations of a species having sufficient genetic homogeneity to represent a reproductively connected whole. However, as demonstrated by Miller _et al_ (2009; 2014), genetic studies indicate that abalone populations (at least of blacklip and greenlip abalone) are made up of what might be termed micro-stocks or meta-populations. In effect, the management units used to set total allowable catches (TACs) and minimum legal sizes (MLS) are indeed just spatial management units (SAUs). The solution adopted in Haddon _et al_ (2013) and Haddon and Mundy (2016) was to generate an operating model made up of numerous relatively small populations of abalone, each with their own set of biological properties and fishery productivity that reflected properties observed within real fisheries. One disadvantage of this approach was that there was no chance of fitting this model to a real fishery as no real fishery has sufficient data available concerning differences in growth, size-at-maturity, and other matters relating to productivity. This meant that one could only attempt to condition the operating model to have outputs and properties that closely matched a real fishery. Of course, as those properties were defined at a large geographical scale there would be no single or unique way of setting up a large number of individual populations to mimic such emergent or sum-of-the-parts properties. 

One time-consuming option to counter this problem would be to set-up the operating model's underlying populations in a number of ways to determine whether each different arrangement leads to the same outcome. While this would be time-consuming it would be one way of characterizing the full uncertainty relating to the spatial dynamics. The use and collection of the GPS data-logger data in the various abalone fisheries (starting in Tasmania; Mundy, ???) will assist with the conditioning of the operating model, but to udnerstand how first requires an introduction into the conceptual framework being used to describe abalone 'stocks' within the MSE's operating model.

### Applications in Victoria

During the project described in Haddon and Mundy (2016), an opportunity arose to apply the abalone MSE to some particular reefs within Western Victoria to examine how their recovery might proceed under different harvest strategies following the viral destruction brought about by the AVG virus (Haddon & Helidoniotis, 2014). This differed from the applications in Tasmania as being focussed solely on one reef complex, known as _The Crags_. While the operating model was still only conditioned on reality using the biological properties known for the abalone on The Crags, more time could be spent improving the comparison of the length composition and historical performance of the fishery. This could be done by selecting combinations of simulated populations whose combined dynamics more closely followed trends in catches and size-composition through time. However, this process was very time-consuming so the objectives of each study need to be made clear and explicit before embarking on such detailed conditioning.

### Why is the Code so Specialized

To date, one reason that running an MSE remains relatively specialized and esoteric is that the simulation framework needs to be able to simulate a wide range of processes (__`r fig_nums("a1",display="cite")`__), including a) the dynamics of the selected biological stock, b) the dynamics of the fishery imposed on the stock, c) the generation of simulated fishery data from the fishery, d) the stock assessment applied to that data, and e) the control rule used to modify the present management options (generally changing the TAC), which are fed back into the dynamics of the stock in a feedback loop within the modelling framework (Punt _et al_, 2016).

<br>


```{r  echo=FALSE, out.width = '80%'}
knitr::include_graphics("C:/Users/User/Dropbox/A_Code/aMSEUse/figures/structure_of_MSE.png")
```

`r fig_nums("a1", caption=" A diagrammatic representation of the main components of an MSE simulation framework, such as used with abalone, and how the feedback cycle operates during the simulations. Redrawn from Haddon et al, 2013.")`

<br><br>

Developing and using such a complex software framework entailed specialized expertise. The disadvantage of this is that it constrains the application and limits future developments. This is the primary reason for attempting to translate the MSE code into a a self-documented R package. If more people can more easily take on the application of using the management strategy evaluation framework to explore management options for abalone stocks this should increase the chances of improvements in management.  

## Some Background on the Operating Model Structure

The operating model (OM) requires conditioning on a selected abalone fishery because the OM acts as a proxy for reality in the simulations. The task of the OM is to model the stock dynamics across all the micro-stocks embedded in the framework. Currently, a selected abalone fishery zone can have more than 100 sub-populations, each with their own defined properties reflecting somewhat different growth, maturity, and other details relating to productivity. However, such a simulation would be extremely complex to condition to a specific fishery simply because the data requirements would be enormous. For each run of the MSE, the number of populations (_numpop_ in the R code) need to be specified and how these are conditioned will, obviously, greatly influence the outcomes.

The original abalone MSE (Haddon _et al_, 2013) was designed for use with the Tasmanian blacklip abalone stocks. Spatially this was structured as statistical blocks within quota zones. Zones were introduced from 2000 onward whereas the statistical blocks have been extant since before 1980. Biological data was available from many sites around Tasmania although it tended to be summarized at a block level. Each statistical block could be simulated as containing multiple populations, and each population has its own set of properties with many such properties relating to the productivity. To attempt to capture some of the between block variations in biological properties each block simulated was given its own set of properties, which included, for many of the properties, a definition of a statistical distribution to describe the expected distribution of values for such things as the growth parameters, the parameters relating to maturity-at-size, and details of the stock recruitment relation. Thus, each sub-set of populations (in Tasmania representing a statistical block but elsewhere they might represent any spatial management unit), was sampled from selected distributions that had been conditioned on what is known about the fishery being simulated. 

Unfortunately, in fisheries management in general, and abalone fisheries in particular, the terminology used to describe different details and concepts is not standardized across jurisdictions. Thus, while the term _Zone_ is used widely to describe a geographical area over which a particular quota may be taken, the names given to sub-zones within zones differs between jurisdictions. The statistical _block_ from Tasmania is not equivalent to the _reef-code_ from Victoria, or _spatial management unit_ from South Australia. Similarly, in Tasmania, the phrase the _Legal Minimum Length_ (LML) is used to define the legal size limits, which is equivalent to the _Minimum Legal Length_, and other such abbreviations from other jurisdictions.


```{r  echo=FALSE, out.width = '80%'}
knitr::include_graphics("C:/Users/User/Dropbox/A_Code/aMSEUse/figures/structure_of_zone.png")
```

`r fig_nums("a2", caption=" A diagrammatic representation of a simulated zone made up of a number of spatial management units (SAUs) each made up of a number of separate populations, each with its own properties. In an operational simulated zone there would likely be more SAUs and more populations in at least some of those SAUs and the populations are likely to be of very different sizes, each population with its own particular properties. Redrawn from Haddon et al, 2013.")`


#####
# Setting Up an MSE

## A Worked Example

Rather than continue with hypothetical arrangements it may be simpler to work through an example MSE run in some detail. A potential work flow might begin with these four steps:

1. Generate a draft data template of the number of areas (termed _SAU_ in the R code) to be simulated using the __aMSE__ function _datafileTemplate_.

2. Edit the .csv file created by _datafileTemplate_ to match the conditioning data available for the fishery being simulation tested.

3. Read the data in the edited .csv file into an R object using _readdataFile_, perhaps use the name _condDat_ for conditioning data.

4. Input the _condDat_ into the __aMSE__ function _makeZone_ to generate each of the simulated populations in each of the blocks to generate the simulated zone. This creates the zone, estimates the productivity of each population, and also returns the generated population definitions produced by _makeZone_ to define each population's properties.

5. Plot out the properties of the simulated zone before using it in any testing to ensure that its properties are similar to available data from the fishery it is intended to approximate. 

In this example, we can simplify this procedure by using a built-in data-set called _condDat_. This will avoid having to save a .csv file somewhere and going through the editing stage, which we will describe in more detail when conditioning the operating model is discussed and described.

```{r "getData", results="hold"}


```

Which determines that there will be two blocks, one with two populations, and the other with four. There are no fishery data (catches or cpue) but we will project the model 20 years into the future. The approach adopted for mimicking an abalone fishery zone. 

The _constants_ object contains the probability density distribution definitions that are sampled to provide the particular biological properties for each population. Each separate block (SAU) has its own set of parameters so that spatial differences can be incorporated in the conditioning.

The object generated by _makeZone_ contains three objects, the first is a complex object containing complete descriptions of each population, the second is a three dimensional array containing the estimated productivity dynamics for each population, and the final object, _popdefs_, is a simple matrix containing the specific biological properties generated for each population. 

```{r "firstZone"}


```

\newline

Descriptions of each of the parameters and the details of the strategy used to generate the OM zone are described in the appendix. Here we will proceed by generating a description of the properties of this example zone. 

Firstly, the populations within the simulated zone making up the Operating Model (OM) all have somewhat different properties. These particular values derive from the array of probability density functions (PDFs) defined in the _constants_ within _condDat_. These parameters can be seen in detail by using the function _writeConstants_ which takes as input the _condDat_ object. Each population is given different properties through random samples being taken from the PDFs. The variation between populations is most noticeable in the growth parameters, the size-at-maturity, and the average recruitment.

`r tab_nums("a1", caption=" The constants used to define the six populations that make up the example zone implied by the built in data set condDat. The variable Mc is now redundant, Some parameters appear to be zero because of rounding.")`

```{r echo=FALSE }

```

\newline

The _popdefs_ tabulate the differences but they can be visualized by plotting the implied growth curves, the implied maturity-at-length, the implied weight-at-length.












# References

Haddon, M. (2007) Fisheries and their management. Pp 515-532. In _Marine Ecology_ (_eds_) S.D. Connell & B.M. Gillanders. Oxford University Press. 630 p.

Haddon, M. (2011) _Modelling and Quantitative Methods in Fisheries_. 2nd Ed. CRC/Chapman & Hall. 449p.


Haddon, M. and F. Helidoniotis (2013) Legal minimum lengths and the management of abalone fisheries. _Journal of Shellfish Research_ __32__:197-208

Haddon, M. and F. Helidoniotis (2014) _Modelling the Potential for Recovery of Western
Victorian Abalone Stocks: The Crags_. Interim Report to 2012/225. Hobart. 61 p.

Haddon, M., Mayfield, S., Helidoniotis, F., Chick, R. and C. Mundy (2013) _Identification and Evaluation of Performance Indicators for Abalone Fisheries_. FRDC Final Report 2007/020. CSIRO Oceans and Atmosphere and Fisheries Research Development Corporation. 295 p.

Haddon, M. and C. Mundy (2016) _Testing abalone empirical harvest strategies for setting TACs and associated LMLs, which include the use of novel spatially explicit performance measures._ FRDC Final Report 2011/028. CSIRO Oceans and Atmosphere and Fisheries Research Development Corporation. Hobart 182p.

Haddon, M., Mundy, C., and D. Tarbath (2008) Using an inverse-logistic model to describe growth increments of blacklip abalone (_Haliotis rubra_) in Tasmania. _Fishery Bulletin_ __106__:58-71

Helidoniotis, F., Haddon, M., Tuck, G., and D. Tarbath (2011) The relative suitability of the von Bertalanffy, Gompertz and inverse logistic models for describing growth in blacklip abalone populations (_Haliotis rubra_) in Tasmania, Australia. _Fisheries Research_ __112__: 13-21

Miller, K.J., Maynard, B.T. and C.N. Mundy (2009) Genetic diversity and gene flow in collapsed and healthy abalone fisheries _Molecular Ecology_ __18__: 200-211

Miller, K.J., Mundy, C.N., and S. Mayfield (2014) Molecular genetics to inform spatial management in benthic invertebrate fisheries: a case study using the Australian Greenlip Abalone _Molecular Ecology_ __23__: 4958-4975

Punt, A.E., Butterworth, D.S., de Moor, C.L., De Oliveira, J.A.A. and M. Haddon (2016) Management strategy evaluation: best practices. _Fish and Fisheries_ __17__: 303-334 DOI: 10.1111/faf.12104

Smith, A.D.M. (1997) Quantification of objectives, strategies and performance criteria for fishery management plans—an Australian perspective.  p291–295 _in_ Hancock, D.A., Smith, D.C., Grant, A. and J.P. Beumer (_eds_) _Developing and Sustaining World Fisheries Resources. The State of Science and Management._ Proceedings of the 2nd World Fisheries Congress. CSIRO Publishing, Collingwood.

